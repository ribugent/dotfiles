#!/usr/bin/env bash
set -euo pipefail


OS=$(uname)

if [[ "$OS" != "Darwin" ]]; then
	exit 0
fi;

# iTerm2 setup loading settings from dotfiles and keeping them in sync
defaults write com.googlecode.iterm2.plist PrefsCustomFolder -string "{{ .chezmoi.workingTree }}/macos"
defaults write com.googlecode.iterm2.plist LoadPrefsFromCustomFolder -bool true
defaults write com.googlecode.iterm2.plist NoSyncNeverRemindPrefsChangesLostForFile_selection -int 2

# qtpass setup
defaults write com.ijhack.QtPass.plist gitExecutable -string "$(brew --prefix)/bin/git"
defaults write com.ijhack.QtPass.plist gpgExecutable -string "$(brew --prefix)/bin/gpg"

# Quaratine bit removal from some apps which are safe bit not signed
sudo xattr -r -d com.apple.quarantine \
	/Applications/DiscreteScroll.app \
	/Applications/Meld.app \
	/Applications/MuteSpotifyAds.app \
	/Applications/QtPass.app
